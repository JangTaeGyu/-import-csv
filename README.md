# Import CSV

> 해당 프로젝트는 Single thread 와 Multi thread 코드에서 대용량 데이터를 CSV 로 DB에 insert 할 때 처리 속도를 확인하고, 그 원인을 분석하는 것을 목표로 합니다.


## 테스트 방법

- **데이터 수**: 10,000건의 데이터 insert 실행
- **테스트 횟수**: 각 경우에 대해 5회 반복 테스트
- **데이터 초기화**: 5회 테스트 후 데이터 전체 delete
- **SQL 출력 설정**: `spring.jpa.show-sql=false`로 설정하여 SQL 출력으로 인한 성능 저하를 방지

## 결과

### Single thread

|            | 1회        | 2회        | 3회        | 4회        | 5회        |
|------------|-----------|-----------|-----------|-----------|-----------|
| 10,000 row | 3,276 ms  | 3,116 ms  | 2,679 ms  | 3,145 ms  | 3,250 ms  |
| 50,000 row | 15,344 ms | 15,006 ms | 15,303 ms | 14,742 ms | 15,141 ms |

### Single thread with transactional

|            | 1회       | 2회       | 3회       | 4회       | 5회       |
|------------|----------|----------|----------|----------|----------|
| 10,000 row | 1,596 ms | 1,545 ms | 1,579 ms | 1,722 ms | 1,695 ms |
| 50,000 row | 7,131 ms | 7,039 ms | 6,954 ms | 7,067 ms | 6,754 ms |

### Multi thread

- **Thread pool**: 10
- **Batch size**: 1,000

|            | 1회       | 2회       | 3회       | 4회       | 5회       |
|------------|----------|----------|----------|----------|----------|
| 10,000 row | 1,249 ms | 1,286 ms | 1,244 ms | 1,256 ms | 1,227 ms |
| 50,000 row | 5,465 ms | 5,482 ms | 5,534 ms | 5,535 ms | 5,482 ms |

## 분석 및 결론

### 1. Single Thread vs. Single Thread with Transactional

단일 스레드에서 `@Transactional` 어노테이션을 사용한 경우가 그렇지 않은 경우보다 성능이 크게 개선되었습니다. 이는 다음과 같은 이유로 설명될 수 있습니다:

- **트랜잭션 오버헤드 감소**: 트랜잭션 없이 10,000건의 데이터를 개별적으로 삽입할 때, 각 삽입 작업마다 커밋이 발생하여 추가적인 오버헤드가 발생합니다. 하지만 트랜잭션을 사용하면 모든 삽입 작업을 하나의 트랜잭션으로 묶어 한 번에 커밋함으로써 이러한 오버헤드를 크게 줄일 수 있습니다.
- **로그 처리 최적화**: 데이터베이스는 트랜잭션 내에서 발생하는 모든 작업을 하나의 논리적 단위로 처리하고, 로그 기록을 효율적으로 관리할 수 있습니다. 이로 인해 성능이 크게 개선됩니다.

### 2. Single Thread with Transactional vs. Multi Thread

멀티 스레드를 사용한 경우가 단일 스레드를 사용한 경우보다 더욱 빠른 성능을 보여주었습니다. 이는 멀티 스레드의 병렬 처리 능력 덕분에 작업을 여러 스레드로 분산시켜 동시에 처리할 수 있었기 때문입니다:

- **병렬 처리의 이점**: 멀티 스레드 환경에서는 여러 스레드가 동시에 데이터를 삽입할 수 있어, 전체 작업 시간이 줄어듭니다. 이는 특히 CPU 코어가 많은 환경에서 더욱 두드러집니다.
- **I/O 및 네트워크 대기 시간 감소**: 여러 스레드가 동시에 작업을 처리함으로써 I/O와 네트워크 대기 시간을 효율적으로 줄일 수 있습니다.

### 3. 결론

이번 실험을 통해 트랜잭션의 중요성과 멀티 스레딩의 이점을 확인할 수 있었습니다. 대용량 데이터를 처리할 때, 트랜잭션을 활용하는 것은 성능을 크게 개선할 수 있으며, 멀티 스레딩을 도입하면 병렬 처리의 장점을 최대한 활용할 수 있습니다.

- 트랜잭션을 사용하여 삽입 작업을 하나의 논리적 단위로 묶는 것이 성능 최적화에 매우 중요합니다.
- 병렬 처리를 통해 대규모 데이터 삽입 작업의 성능을 극대화할 수 있습니다.

이 결과는 대용량 데이터를 처리하는 시스템에서 성능을 최적화하는 데 유용한 참고자료가 되었습니다.